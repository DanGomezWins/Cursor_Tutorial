<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaboom.js Platform Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 2px solid #34495e;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <script src="https://unpkg.com/kaboom@3000.0.1/dist/kaboom.js"></script>
    <script>
        // Initialize Kaboom
        kaboom({
            width: 800,
            height: 600,
            background: [135, 206, 235], // Sky blue background
        });

        // Set gravity
        setGravity(1600);

        // Create the player
        const player = add([
            rect(32, 48),
            color(255, 100, 100), // Red color
            pos(100, 300),
            area(),
            body(),
            "player"
        ]);

        // Create platforms
        const platforms = [
            // Ground platform
            { x: 0, y: 550, width: 800, height: 50 },
            // Floating platforms
            { x: 200, y: 450, width: 150, height: 20 },
            { x: 450, y: 350, width: 150, height: 20 },
            { x: 100, y: 250, width: 150, height: 20 },
            { x: 600, y: 200, width: 150, height: 20 },
            { x: 300, y: 150, width: 150, height: 20 },
        ];

        // Add platforms to the game
        platforms.forEach(platform => {
            add([
                rect(platform.width, platform.height),
                color(100, 200, 100), // Green color
                pos(platform.x, platform.y),
                area(),
                body({ isStatic: true }),
                "platform"
            ]);
        });

        // Movement constants
        const SPEED = 200;
        const JUMP_FORCE = 900;

        // Handle player movement
        onUpdate(() => {
            // Left movement
            if (isKeyDown("left") || isKeyDown("a")) {
                player.move(-SPEED, 0);
            }
            
            // Right movement
            if (isKeyDown("right") || isKeyDown("d")) {
                player.move(SPEED, 0);
            }
        });

        // Handle jumping
        onKeyPress("space", () => {
            if (player.isGrounded()) {
                player.jump(JUMP_FORCE);
            }
        });

        onKeyPress("up", () => {
            if (player.isGrounded()) {
                player.jump(JUMP_FORCE);
            }
        });

        onKeyPress("w", () => {
            if (player.isGrounded()) {
                player.jump(JUMP_FORCE);
            }
        });

        // Enemy movement logic
        onUpdate("enemy", (enemy) => {
            // Move enemy based on direction
            enemy.move(enemy.speed * enemy.direction, 0);
            
            // Reverse direction when reaching patrol boundaries
            if (enemy.pos.x >= enemy.patrolEnd) {
                enemy.direction = -1;
            } else if (enemy.pos.x <= enemy.patrolStart) {
                enemy.direction = 1;
            }
        });

        // Reset player if they fall off the screen
        onUpdate("player", (p) => {
            if (p.pos.y > height()) {
                p.pos = vec2(100, 300);
            }
        });

        // Add instructions text
        add([
            text("Use ARROW KEYS or WASD to move\nSPACE/UP/W to jump\nAvoid red enemies and spikes!", {
                size: 14,
            }),
            color(255, 255, 255),
            pos(20, 20),
        ]);

        // Add enemies that patrol platforms
        const enemies = [
            { x: 200, y: 420, width: 30, height: 30, patrolStart: 200, patrolEnd: 350, speed: 50 },
            { x: 450, y: 320, width: 30, height: 30, patrolStart: 450, patrolEnd: 600, speed: 40 },
            { x: 300, y: 120, width: 30, height: 30, patrolStart: 300, patrolEnd: 450, speed: 60 },
        ];

        enemies.forEach((enemy, index) => {
            const enemyObj = add([
                rect(enemy.width, enemy.height),
                color(200, 50, 50), // Dark red color
                pos(enemy.x, enemy.y),
                area(),
                body({ isStatic: true }),
                "enemy"
            ]);
            
            // Add enemy movement
            enemyObj.direction = 1; // 1 for right, -1 for left
            enemyObj.patrolStart = enemy.patrolStart;
            enemyObj.patrolEnd = enemy.patrolEnd;
            enemyObj.speed = enemy.speed;
        });

        // Add spikes on some platforms
        const spikes = [
            { x: 220, y: 520, width: 20, height: 20 },
            { x: 240, y: 520, width: 20, height: 20 },
            { x: 260, y: 520, width: 20, height: 20 },
            { x: 470, y: 320, width: 20, height: 20 },
            { x: 490, y: 320, width: 20, height: 20 },
            { x: 320, y: 120, width: 20, height: 20 },
            { x: 340, y: 120, width: 20, height: 20 },
        ];

        spikes.forEach(spike => {
            // Create triangular spike using multiple rectangles
            const spikeHeight = spike.height;
            const spikeWidth = spike.width;
            
            // Create the main triangular body using a rotated rectangle approach
            // We'll use a single rectangle but make it look more spike-like
            add([
                rect(spikeWidth, spikeHeight),
                color(100, 50, 50), // Dark red color
                pos(spike.x, spike.y),
                area(),
                "spike"
            ]);
            
            // Add a smaller rectangle on top to create a more pointed look
            add([
                rect(spikeWidth * 0.6, spikeHeight * 0.3),
                color(80, 40, 40), // Slightly darker red
                pos(spike.x + spikeWidth * 0.2, spike.y - spikeHeight * 0.2),
                area(),
                "spike"
            ]);
        });

        // Add a goal/target
        add([
            rect(40, 40),
            color(255, 255, 100), // Yellow color
            pos(650, 100),
            area(),
            "goal"
        ]);

        add([
            text("GOAL", {
                size: 12,
            }),
            color(255, 255, 255),
            pos(655, 80),
        ]);

        // Game over conditions
        onCollide("player", "enemy", () => {
            add([
                text("GAME OVER!\nYou hit an enemy!\nPress R to restart", {
                    size: 24,
                }),
                color(255, 100, 100),
                pos(center().x - 150, center().y - 50),
                "gameOverText"
            ]);
        });

        onCollide("player", "spike", () => {
            add([
                text("GAME OVER!\nYou hit spikes!\nPress R to restart", {
                    size: 24,
                }),
                color(255, 100, 100),
                pos(center().x - 150, center().y - 50),
                "gameOverText"
            ]);
        });

        // Win condition
        onCollide("player", "goal", () => {
            add([
                text("YOU WIN!\nPress R to restart", {
                    size: 32,
                }),
                color(255, 255, 255),
                pos(center().x - 120, center().y - 50),
                "winText"
            ]);
        });

        // Restart functionality
        onKeyPress("r", () => {
            destroyAll("winText");
            destroyAll("gameOverText");
            player.pos = vec2(100, 300);
        });

        // Debug info - remove this later
        onUpdate(() => {
            // Check if keys are being pressed
            if (isKeyDown("left") || isKeyDown("a") || isKeyDown("right") || isKeyDown("d")) {
                console.log("Key pressed!");
            }
        });
    </script>
</body>
</html>